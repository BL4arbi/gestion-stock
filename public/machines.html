<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machines - Gestion Stock</title>
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/machines.css" />
    <script
      type="module"
      src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"
    ></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-brand">
        <img src="/images/logo.png" alt="Logo" class="nav-logo" />
        <span class="nav-title">TACQUET INDUSTRIES</span>
      </div>
      <div class="nav-links">
        <a href="/dashboard.html" class="nav-link">üè† Accueil</a>
        <a href="/stock.html" class="nav-link">üì¶ Stock</a>
        <a href="/machines.html" class="nav-link active">ü§ñ Machines</a>
      </div>
      <div class="nav-user">
        <span class="user-badge">üë§ <span id="username">admin</span></span>
        <button id="logout-btn" class="btn-logout">üö™ D√©connexion</button>
      </div>
    </nav>

    <div class="container">
      <header class="page-header">
        <div class="header-left">
          <h1>ü§ñ Machines</h1>
          <span id="sw-agent-status" class="agent-badge offline">
            <span class="badge-dot"></span>
            Agent non connect√©
          </span>
        </div>
        <button id="add-machine-btn" class="btn btn-primary">
          <span class="btn-icon">‚ûï</span>
          Ajouter une machine
        </button>
      </header>

      <!-- Formulaire d'ajout/√©dition -->
      <div id="machine-form-container" class="form-container hidden">
        <div class="form-card">
          <div class="form-header">
            <h2 id="form-title">‚ûï Nouvelle machine</h2>
            <button id="cancel-form-btn" class="btn-icon-only" title="Annuler">
              ‚úï
            </button>
          </div>
          <form id="machine-form" class="machine-form">
            <div class="form-row">
              <div class="form-field">
                <label>Nom *</label>
                <input
                  type="text"
                  name="nom"
                  placeholder="Ex: Fraiseuse DMG Mori"
                  required
                />
              </div>
              <div class="form-field">
                <label>R√©f√©rence *</label>
                <input
                  type="text"
                  name="reference"
                  placeholder="Ex: DMU-50"
                  required
                />
              </div>
              <div class="form-field">
                <label>Quantit√© *</label>
                <input
                  type="number"
                  name="quantite"
                  value="1"
                  min="0"
                  required
                />
              </div>
              <div class="form-field">
                <label>Localisation</label>
                <input
                  type="text"
                  name="localisation"
                  placeholder="Ex: Atelier 1"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-field">
                <label>Prix (‚Ç¨)</label>
                <input
                  type="number"
                  name="prix"
                  step="0.01"
                  min="0"
                  value="0"
                />
              </div>
              <div class="form-field">
                <label>Seuil d'alerte</label>
                <input type="number" name="seuil_alert" value="5" min="0" />
              </div>
              <div class="form-field">
                <label>Dimensions</label>
                <input
                  type="text"
                  name="dimensions"
                  placeholder="Ex: 1200x800x600"
                />
              </div>
              <div class="form-field">
                <label>Poids (kg)</label>
                <input
                  type="number"
                  name="poids"
                  step="0.01"
                  min="0"
                  value="0"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-field full-width">
                <label>Fichier SolidWorks (chemin r√©seau)</label>
                <input
                  type="text"
                  name="solidworks_link"
                  placeholder="Ex: R:\CAO\Machine\fichier.SLDASM"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-field full-width">
                <label>Mod√®le 3D (.glb/.gltf)</label>
                <div class="file-input-wrapper">
                  <input
                    type="file"
                    name="glb_file"
                    accept=".glb,.gltf"
                    id="glb-input"
                  />
                  <label for="glb-input" class="file-label">
                    <span class="file-icon">üìÅ</span>
                    <span id="file-name">Choisir un fichier</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                type="button"
                id="cancel-form-btn-2"
                class="btn btn-secondary"
              >
                Annuler
              </button>
              <button type="submit" class="btn btn-primary">
                <span class="btn-icon">üíæ</span>
                Enregistrer
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Barre de recherche et filtres -->
      <div class="toolbar">
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            id="search-input"
            placeholder="Rechercher une machine..."
          />
        </div>
        <select id="sort-select" class="sort-select">
          <option value="recent">Plus r√©cent</option>
          <option value="name">Nom A-Z</option>
          <option value="quantity">Quantit√©</option>
          <option value="price">Prix</option>
        </select>
      </div>

      <!-- Grille des machines -->
      <div id="machines-grid" class="machines-grid">
        <!-- Rempli dynamiquement -->
      </div>
    </div>

    <!-- Modal d√©tails -->
    <div id="machine-modal" class="modal hidden">
      <!-- Rempli dynamiquement -->
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/notifications.js"></script>
    <script src="/js/sw-agent-client.js"></script>
    <script src="/js/machines.js"></script>
  </body>
</html>
